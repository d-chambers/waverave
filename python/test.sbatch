#!/bin/bash
#SBATCH -N 1
#SBATCH --ntasks-per-node 8

#SBATCH -t 00:15:00



module load mpi/openmpi/gcc/4.1.1
module load apps/python3/2022.10

conda activate mpirun

#python ---version

#mpirun -n 5 python test_unit.py 100 100


echo ""
echo "Creating Mesh For 1 Process"

mkdir outputs
mkdir outputs/plots

mpirun -n 1 python src/mesher.py 300 500

echo ""
echo "Running Simulation with 1 Process"
echo ""
mpirun -n 1 python src/run.py 300 500 1

echo ""
echo "Plotting for 1 process"

mkdir outputs/plots
python src/plot.py 300 500 1

mv outputs outputs_with_1_process

mkdir outputs



echo ""
echo ""
echo "Creating Mesh For 8 Processes"

mpirun -n 8 python src/mesher.py 300 500
echo ""
echo "Running Simulation with 8 Processes"
echo ""

mpirun -n 8 python src/run.py 300 500 1

echo $start $end | awk '{print $2-$1}'
mkdir outputs/plots
echo ""
echo "Plotting for 8 processes"
python src/plot.py 300 500 8


mv outputs outputs_with_8_process

mkdir outputs
mkdir outputs/plots


echo "Check the plots generated by running with 1 and 8 process and see if they are same"

python test_integrated.py 300 500 1 8
